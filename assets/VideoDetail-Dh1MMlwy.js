import{c as K,m as O,P as g,d as Q,o as r,h as W,O as $,Q as J,R as X,S as Y,T as Z,a as w,w as P,K as ee,p as te,q as z,v as D,x as B,D as c,G as p,z as ne,A as V,U as se,C as oe,F as ae,E as ce}from"./index-DDCgj_Ao.js";import{_ as le,I as ie}from"./index-G1VnjAgF.js";const[de,F]=K("text-ellipsis"),ue={rows:O(1),dots:g("..."),content:g(""),expandText:g(""),collapseText:g(""),position:g("end")};var re=Q({name:de,props:ue,emits:["clickAction"],setup(n,{emit:_,slots:y}){const T=r(""),a=r(!1),k=r(!1),m=r();let C=!1;const f=W(()=>a.value?n.collapseText:n.expandText),M=e=>{if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},l=()=>{if(!m.value||!m.value.isConnected)return;const e=window.getComputedStyle(m.value),t=document.createElement("div");return Array.prototype.slice.apply(e).forEach(A=>{t.style.setProperty(A,e.getPropertyValue(A))}),t.style.position="fixed",t.style.zIndex="-9999",t.style.top="-9999px",t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.innerText=n.content,document.body.appendChild(t),t},N=()=>{const e=(u,R)=>{const{content:v,position:E,dots:h}=n,x=v.length,G=()=>{const s=(o,d)=>{if(d-o<=1)return E==="end"?v.slice(0,o)+h:h+v.slice(d,x);const i=Math.round((o+d)/2);return E==="end"?u.innerText=v.slice(0,i)+h+f.value:u.innerText=h+v.slice(i,x)+f.value,u.offsetHeight>R?E==="end"?s(o,i):s(i,d):E==="end"?s(i,d):s(o,i)};u.innerText=s(0,x)},S=(s,o)=>{if(s[1]-s[0]<=1&&o[1]-o[0]<=1)return v.slice(0,s[0])+h+v.slice(o[1],x);const d=Math.floor((s[0]+s[1])/2),i=Math.ceil((o[0]+o[1])/2);return u.innerText=n.content.slice(0,d)+n.dots+n.content.slice(i,x)+n.expandText,u.offsetHeight>=R?S([s[0],d],[i,o[1]]):S([d,s[1]],[o[0],i])},j=0+x>>1;return n.position==="middle"?u.innerText=S([0,j],[j,x]):G(),u.innerText},t=l();if(!t){C=!0;return}const{paddingBottom:L,paddingTop:A,lineHeight:q}=t.style,U=Math.ceil((Number(n.rows)+.5)*M(q)+M(A)+M(L));U<t.offsetHeight?(k.value=!0,T.value=e(t,U)):(k.value=!1,T.value=n.content),document.body.removeChild(t)},b=(e=!a.value)=>{a.value=e},H=e=>{b(),_("clickAction",e)},I=()=>{const e=y.action?y.action({expanded:a.value}):f.value;return w("span",{class:F("action"),onClick:H},[e])};return $(N),J(()=>{C&&(C=!1,N())}),X([Y,()=>[n.content,n.rows,n.position]],N),Z({toggle:b}),()=>w("div",{ref:m,class:F()},[a.value?n.content:T.value,k.value?I():null])}});const me=P(re),ve=["src"],xe={class:"py-2 flex justify-between items-center"},pe={class:""},_e={class:"text-sm text-stone-500"},fe={class:"flex"},ye={key:0,class:"p-2 text-xs w-full rounded-md text-stone-300 bg-stone-700"},he={class:"text-sm w-full"},ge={class:"flex"},we={class:"ml-2 text-stone-500"},Ce={__name:"VideoDetail",setup(n){const _=ee().params.id,y=r([]);(async()=>{const{data:l}=await D.urlMv(_);y.value=l})();const a=r([]);(async()=>{const{data:l}=await D.mvDetail(_);a.value=l})();const m=r([]);(async()=>{const l=await D.mvLikeCount(_);m.value=l})();const f=r([]);return(async()=>{const l=await D.mvComment(_);f.value=l.comments})(),(l,N)=>{const b=ce,H=me,I=ie;return B(),te(le,{leftArrow:!0},{default:z(()=>[c("video",{src:y.value.url,controls:"",muted:"",class:"rounded-md"},null,8,ve),c("div",xe,[c("div",null,[c("p",pe,p(a.value.name),1),c("p",_e,p(a.value.artistName)+" "+p(a.value.publishTime),1)]),c("div",fe,[w(b,{round:"",icon:"good-job-o",type:"primary"},{default:z(()=>[ne(p(m.value.likedCount),1)]),_:1})])]),a.value.desc?(B(),V("div",ye,[w(H,{rows:"3",content:a.value.desc,"expand-text":"展开","collapse-text":"收起"},null,8,["content"])])):se("",!0),(B(!0),V(ae,null,oe(f.value,e=>(B(),V("div",{key:e.id,class:"my-2 flex items-start"},[w(I,{class:"mr-2",round:"",width:"3rem",fit:"cover",position:"center",src:e.user.avatarUrl},null,8,["src"]),c("div",he,[c("div",ge,[c("p",null,p(e.user.nickname),1),c("p",we,p(e.timeStr),1)]),c("p",null,p(e.content),1)])]))),128))]),_:1})}}};export{Ce as default};
